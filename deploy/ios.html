





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>iOS App and Swift API &mdash; mlc-llm 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/tlcpack_theme.css" type="text/css" />

  
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Android App" href="android.html" />
    <link rel="prev" title="Python API and Gradio Frontend" href="python.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://mlc.ai/mlc-llm>Home</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/mlc-ai/mlc-llm>Github</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://discord.gg/9Xpy2HGBuD>Discord Server</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   Other Resources
                 </button>
                 <ul>
                     <li>
                       <a href=https://mlc.ai/>MLC Course</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/blog>MLC Blog</a>
                     </li>
                     <li>
                       <a href=https://webllm.mlc.ai/>Web LLM</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Other Resources
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://mlc.ai/>MLC Course</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/blog>MLC Blog</a>
                     </li>
                     <li>
                       <a href=https://webllm.mlc.ai/>Web LLM</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/mlc-logo-with-text-landscape.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
                <div class="version">
                  0.1.0
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/try_out.html">Try out MLC Chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/project_overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/mlc_chat_config.html">Configure MLCChat in JSON</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build and Deploy Apps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="javascript.html">WebLLM and Javascript API</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">Rest API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI and C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python API and Gradio Frontend</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">iOS App and Swift API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use-pre-built-ios-app">Use Pre-built iOS App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-ios-app-from-source">Build iOS App from Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-install-build-dependencies">Step 1. Install Build Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-download-prebuilt-weights-and-library">Step 2. Download Prebuilt Weights and Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-build-auxiliary-components">Step 3. Build Auxiliary Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-build-ios-app">Step 4. Build iOS App</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#customize-the-app">Customize the App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-apps-with-mlc-swift-api">Build Apps with MLC Swift API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="android.html">Android App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compile Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../compilation/compile_models.html">Compile Models via MLC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/distribute_compiled_models.html">Distribute Compiled Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Define Model Architectures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/customize/define_new_models.html">Define New Model Architectures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Prebuilt Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prebuilt_models.html">Model Prebuilts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dependency Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/tvm.html">Install TVM Unity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/conda.html">Install Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/gpu.html">GPU Drivers and SDKs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/emcc.html">Install Wasm Build Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/guideline.html">Community Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- mlc-llm -->
              Table of Contents
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> <span class="br-arrow">></span></li>
        
      <li>iOS App and Swift API</li>
    
    
      
      
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/mlc-ai/mlc-llm/edit/main/docs/deploy/ios.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="ios-app-and-swift-api">
<span id="deploy-ios"></span><h1>iOS App and Swift API<a class="headerlink" href="#ios-app-and-swift-api" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#use-pre-built-ios-app" id="id2">Use Pre-built iOS App</a></p></li>
<li><p><a class="reference internal" href="#build-ios-app-from-source" id="id3">Build iOS App from Source</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1-install-build-dependencies" id="id4">Step 1. Install Build Dependencies</a></p></li>
<li><p><a class="reference internal" href="#step-2-download-prebuilt-weights-and-library" id="id5">Step 2. Download Prebuilt Weights and Library</a></p></li>
<li><p><a class="reference internal" href="#step-3-build-auxiliary-components" id="id6">Step 3. Build Auxiliary Components</a></p></li>
<li><p><a class="reference internal" href="#step-4-build-ios-app" id="id7">Step 4. Build iOS App</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#customize-the-app" id="id8">Customize the App</a></p></li>
<li><p><a class="reference internal" href="#build-apps-with-mlc-swift-api" id="id9">Build Apps with MLC Swift API</a></p></li>
</ul>
</nav>
<p>The MLC LLM iOS app can be installed in two ways: through the pre-built package or by building from source.
If you are an iOS user looking to try out the models, the pre-built package is recommended. If you are a
developer seeking to integrate new features into the package, building the iOS package from source is required.</p>
<section id="use-pre-built-ios-app">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Use Pre-built iOS App</a><a class="headerlink" href="#use-pre-built-ios-app" title="Permalink to this heading">¶</a></h2>
<p>The MLC Chat app is now available in App Store at no cost. You can download and explore it by simply clicking the button below:</p>
<blockquote>
<div><a class="reference external image-reference" href="https://apps.apple.com/us/app/mlc-chat/id6448482937"><img alt="https://linkmaker.itunes.apple.com/assets/shared/badges/en-us/appstore-lrg.svg" src="https://linkmaker.itunes.apple.com/assets/shared/badges/en-us/appstore-lrg.svg" width="135" /></a>
</div></blockquote>
</section>
<section id="build-ios-app-from-source">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Build iOS App from Source</a><a class="headerlink" href="#build-ios-app-from-source" title="Permalink to this heading">¶</a></h2>
<p>This section shows how we can build the app from source.</p>
<section id="step-1-install-build-dependencies">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Step 1. Install Build Dependencies</a><a class="headerlink" href="#step-1-install-build-dependencies" title="Permalink to this heading">¶</a></h3>
<p>First and foremost, please clone the <a class="reference external" href="https://github.com/mlc-ai/mlc-llm">MLC LLM GitHub repository</a>.</p>
<p>Please follow <a class="reference internal" href="../install/tvm.html"><span class="doc">Install TVM Unity</span></a> to install TVM Unity.
Note that we <strong>do not</strong> have to run <cite>build.py</cite> since we can use prebuilt weights.
We only need TVM Unity’s utility to combine the libraries (<cite>local-id-iphone.tar</cite>) into a single library.</p>
<p>We also need to have the following build dependencies:</p>
<ul class="simple">
<li><p>CMake &gt;= 3.24,</p></li>
<li><p>Git and Git-LFS,</p></li>
<li><p><a class="reference external" href="https://www.rust-lang.org/tools/install">Rust and Cargo</a>, which are required by Hugging Face’s tokenizer.</p></li>
</ul>
</section>
<section id="step-2-download-prebuilt-weights-and-library">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Step 2. Download Prebuilt Weights and Library</a><a class="headerlink" href="#step-2-download-prebuilt-weights-and-library" title="Permalink to this heading">¶</a></h3>
<p>You also need to obtain a copy of the MLC-LLM source code
by cloning the <a class="reference external" href="https://github.com/mlc-ai/mlc-llm">MLC LLM GitHub repository</a>.
To simplify the build, we will use prebuilt model
weights and libraries here. Run the following command
in the root directory of the MLC-LLM.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>dist/prebuilt
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/mlc-ai/binary-mlc-llm-libs.git<span class="w"> </span>dist/prebuilt/lib

<span class="nb">cd</span><span class="w"> </span>dist/prebuilt
git<span class="w"> </span>lfs<span class="w"> </span>install
git<span class="w"> </span>clone<span class="w"> </span>https://huggingface.co/mlc-ai/mlc-chat-RedPajama-INCITE-Chat-3B-v1-q4f16_1
<span class="nb">cd</span><span class="w"> </span>../..
</pre></div>
</div>
<p>Validate that the files and directories exist:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>./dist/prebuilt/lib/*-iphone.tar
./dist/prebuilt/lib/RedPajama-INCITE-Chat-3B-v1-q4f16_1-iphone.tar
./dist/prebuilt/lib/Llama-2-7b-chat-hf-q3f16_1-iphone.tar
...

&gt;&gt;&gt;<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>./dist/prebuilt/mlc-chat-RedPajama-INCITE-Chat-3B-v1-q4f16_1
<span class="c1"># chat config:</span>
mlc-chat-config.json
<span class="c1"># model weights:</span>
ndarray-cache.json
params_shard_*.bin
...
</pre></div>
</div>
</section>
<section id="step-3-build-auxiliary-components">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Step 3. Build Auxiliary Components</a><a class="headerlink" href="#step-3-build-auxiliary-components" title="Permalink to this heading">¶</a></h3>
<p><strong>Tokenizer and runtime</strong></p>
<p>In addition to the model itself, a lightweight runtime and tokenizer are
required to actually run the LLM. You can build and organize these
components by following these steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive
<span class="nb">cd</span><span class="w"> </span>./ios
./prepare_libs.sh
</pre></div>
</div>
<p>This will create a <code class="docutils literal notranslate"><span class="pre">./build</span></code> folder that contains the following files.
Please make sure all the following files exist in <code class="docutils literal notranslate"><span class="pre">./build/</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>ls<span class="w"> </span>./build/lib/
libmlc_llm.a<span class="w">         </span><span class="c1"># A lightweight interface to interact with LLM, tokenizer, and TVM Unity runtime</span>
libmodel_iphone.a<span class="w">    </span><span class="c1"># The compiled model lib</span>
libsentencepiece.a<span class="w">   </span><span class="c1"># SentencePiece tokenizer</span>
libtokenizers_cpp.a<span class="w">  </span><span class="c1"># Huggingface tokenizer</span>
libtvm_runtime.a<span class="w">     </span><span class="c1"># TVM Unity runtime</span>
</pre></div>
</div>
<p><strong>Add prepackage model</strong></p>
<p>We can also <em>optionally</em> add prepackage weights into the app,
run the following command under the <code class="docutils literal notranslate"><span class="pre">./ios</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>./ios
open<span class="w"> </span>./prepare_params.sh<span class="w"> </span><span class="c1"># make sure builtin_list only contains &quot;RedPajama-INCITE-Chat-3B-v1-q4f16_1&quot;</span>
./prepare_params.sh
</pre></div>
</div>
<p>The outcome should be as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>ls<span class="w"> </span>./dist/
RedPajama-INCITE-Chat-3B-v1-q4f16_1
</pre></div>
</div>
</section>
<section id="step-4-build-ios-app">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Step 4. Build iOS App</a><a class="headerlink" href="#step-4-build-ios-app" title="Permalink to this heading">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">./ios/MLCChat.xcodeproj</span></code> using Xcode. Note that you will need an
Apple Developer Account to use Xcode, and you may be prompted to use
your own developer team credential and product bundle identifier.</p>
<p>Ensure that all the necessary dependencies and configurations are
correctly set up in the Xcode project.</p>
<p>Once you have made the necessary changes, build the iOS app using Xcode.
If you have an Apple Silicon Mac, you can select target “My Mac (designed for ipad)”
to run on your Mac. You can also directly run it on your iPad or iPhone.</p>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/mlc-ai/web-data/main/images/mlc-llm/tutorials/xcode-build.jpg"><img alt="https://raw.githubusercontent.com/mlc-ai/web-data/main/images/mlc-llm/tutorials/xcode-build.jpg" class="align-center" src="https://raw.githubusercontent.com/mlc-ai/web-data/main/images/mlc-llm/tutorials/xcode-build.jpg" style="width: 60%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="customize-the-app">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Customize the App</a><a class="headerlink" href="#customize-the-app" title="Permalink to this heading">¶</a></h2>
<p>We can customize the iOS app in several ways.
<a class="reference external" href="https://github.com/mlc-ai/mlc-llm/blob/main/ios/MLCChat/app-config.json">MLCChat/app-config.json</a>
controls the list of model URLs and model libs to be packaged into the app.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">model_libs</span></code></dt><dd><p>List of model libraries to be packaged into the app. <code class="docutils literal notranslate"><span class="pre">./prepare_libs.sh</span></code>
will look at this field, find compiled or prebuilt model libraries, and package them into <code class="docutils literal notranslate"><span class="pre">libmodel_iphone.a</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">model_list</span></code></dt><dd><p>List of models that can be downloaded from the Internet. These models
<strong>must</strong> use the model lib packaged in the app.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">add_model_samples</span></code></dt><dd><p>A list of example URLs that show up when the user clicks add model.</p>
</dd>
</dl>
<p>Additionally, the app prepackages the models under <code class="docutils literal notranslate"><span class="pre">./ios/dist</span></code>.
This built-in list can be controlled by editing <code class="docutils literal notranslate"><span class="pre">prepare_params.sh</span></code>.
You can package new prebuilt models or compiled models by changing the above fields and then repeat the steps above.</p>
</section>
<section id="build-apps-with-mlc-swift-api">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Build Apps with MLC Swift API</a><a class="headerlink" href="#build-apps-with-mlc-swift-api" title="Permalink to this heading">¶</a></h2>
<p>We also provide a Swift package that you can use to build
your own app. The package is located under <cite>ios/MLCSwift</cite>.</p>
<ul>
<li><p>First make sure you have run the same steps listed
in the previous section. This will give us the necessary libraries
under <code class="docutils literal notranslate"><span class="pre">/path/to/ios/build/lib</span></code>.</p></li>
<li><p>Then you can add <code class="docutils literal notranslate"><span class="pre">ios/MLCSwift</span></code> package to your app in Xcode.
Under “Frameworks, Libraries, and Embedded Content”, click add package dependencies
and add local package that points to <code class="docutils literal notranslate"><span class="pre">ios/MLCSwift</span></code>.</p></li>
<li><p>Finally, we need to add the libraries dependencies. Under build settings:</p>
<ul class="simple">
<li><p>Add library search path <code class="docutils literal notranslate"><span class="pre">/path/to/ios/build/lib</span></code>.</p></li>
<li><p>Add the following items to “other linker flags”.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">-</span><span class="n">all_load</span>
<span class="o">-</span><span class="n">lmodel_iphone</span>
<span class="o">-</span><span class="n">lmlc_llm</span> <span class="o">-</span><span class="n">ltvm_runtime</span>
<span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">-</span><span class="n">noall_load</span>
<span class="o">-</span><span class="n">ltokenizers_cpp</span>
<span class="o">-</span><span class="n">lsentencepiece</span>
<span class="o">-</span><span class="n">ltokenizers_c</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>You can then can import the <cite>MLCSwift</cite> package in your app.
The following code shows an illustrative example about how to use the chat module.</p>
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="kd">import</span> <span class="nc">MLCSwift</span>

<span class="kd">let</span> <span class="nv">threadWorker</span> <span class="p">=</span> <span class="n">ThreadWorker</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">chat</span> <span class="p">=</span> <span class="n">ChatModule</span><span class="p">()</span>

<span class="n">threadWorker</span><span class="p">.</span><span class="n">push</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nv">modelLib</span> <span class="p">=</span> <span class="s">&quot;model-lib-name&quot;</span>
   <span class="kd">let</span> <span class="nv">modelPath</span> <span class="p">=</span> <span class="s">&quot;/path/to/model/weights&quot;</span>
   <span class="kd">let</span> <span class="nv">input</span> <span class="p">=</span> <span class="s">&quot;What is the capital of Canada?&quot;</span>
   <span class="n">chat</span><span class="p">.</span><span class="n">reload</span><span class="p">(</span><span class="n">modelLib</span><span class="p">,</span> <span class="n">modelPath</span><span class="p">:</span> <span class="n">modelPath</span><span class="p">)</span>

   <span class="n">chat</span><span class="p">.</span><span class="n">prefill</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
   <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">chat</span><span class="p">.</span><span class="n">stopped</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">displayReply</span><span class="p">(</span><span class="n">chat</span><span class="p">.</span><span class="n">getMessage</span><span class="p">())</span>
      <span class="n">chat</span><span class="p">.</span><span class="n">decode</span><span class="p">()</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the chat module makes heavy use of GPU and thread-local
resources, it needs to run on a dedicated background thread.
Therefore, <strong>avoid using</strong> <cite>DispatchQueue</cite>, which can cause context switching to
different threads and segfaults due to thread-safety issue.
Use the <cite>ThreadWorker</cite> class to launch all the jobs related
to the chat module. You can check out the source code of
the MLCChat app for a complete example.</p>
</div>
</section>
</section>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="android.html" class="btn btn-neutral float-right" title="Android App" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="python.html" class="btn btn-neutral float-left" title="Python API and Gradio Frontend" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../_static/img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <div class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <div class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">© 2023 MLC LLM</h5>
        </div>
      </div>

    </div>

    <div>
      <div class="footernote"> </div>
    </div>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>